<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>EcoPharm</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.1.3/assets/owl.carousel.min.css" />

    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css" />

    <!-- fonts style -->
    <link href="https://fonts.googleapis.com/css?family=Baloo+Chettan|Dosis:400,600,700|Poppins:400,600,700&display=swap" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="/css/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="/css/responsive.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <style>
        .sidebar {
            background-color: #f8f9fa;
            padding: 20px;
            height: 100vh; /* Full màn hình */
        }
        .body-area {
            background-color: #f8f9fa;
            padding: 20px;
        }
    </style>
</head>
<body>

<!-- Header -->
<div th:include="static/header :: header"></div>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 sidebar">
            <h5>Loại thuốc</h5>
            <ul id="categoryMedicineList" class="list-group">
                <!-- Danh mục thuốc sẽ được thêm vào đây -->
            </ul>
        </div>

        <!-- Sản phẩm -->
        <div class="col-md-9 body-area">
            <div class="row mt-5" id="medicineContainer">
                <!-- Sản phẩm sẽ được thêm vào đây -->
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div th:include="static/footer :: footer"></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/jquery-3.4.1.min.js"></script>

<script>
    const API_URL = "/api/medicines";
    const API_CATEGORY = "/api/category-medicine";

    async function fetchMedicinesIndex() {
        try {
            const response = await fetch(API_URL);
            const medicines = await response.json();
            const medicineContainer = document.getElementById('medicineContainer');

            // Xóa dữ liệu cũ trước khi thêm mới
            medicineContainer.innerHTML = "";

            medicines.forEach((medicine) => {
                const formattedPrice = new Intl.NumberFormat('vi-VN', {
                    style: 'currency',
                    currency: 'VND'
                }).format(medicine.price);

                const medicineCard = document.createElement('div');
                medicineCard.classList.add('col-lg-4', 'col-md-6', 'mb-4'); // Hiển thị ngang

                medicineCard.innerHTML = `
                    <div class="card h-100 shadow-sm">
                        <a href="/detail-medicine?id=${medicine.id}" class="text-decoration-none text-dark">
                            <img class="card-img-top" src="${medicine.image}" alt="${medicine.name}">
                            <div class="card-body">
                                <h5 class="card-title">${medicine.name}</h5>
                                <p class="text-muted">${medicine.categoryMedicine.categoryMedicineName}</p>
                                <h6 class="text-primary font-weight-bold">${formattedPrice}</h6>
                            </div>
                        </a>
                        <div class="card-footer text-center">
                            <button class="btn btn-success w-100" onclick="addToCart('${medicine.name}', ${medicine.price})">
                                Chọn mua
                            </button>
                        </div>
                    </div>
                `;

                medicineContainer.appendChild(medicineCard);
            });
        } catch (error) {
            console.error('Lỗi khi tải sản phẩm:', error);
        }
    }

    async function fetchCategories() {
        try {
            const response = await fetch(API_CATEGORY);
            const data = await response.json();

            const categoryList = document.getElementById("categoryMedicineList");
            categoryList.innerHTML = "";

            data.forEach(category => {
                let listItem = document.createElement("li");
                listItem.classList.add("list-group-item", "cursor-pointer");
                listItem.innerHTML = `
                <a href="/products?category=${category.id}" class="text-decoration-none text-dark">
                    ${category.categoryMedicineName}
                </a>
            `;
                categoryList.appendChild(listItem);
            });
        } catch (error) {
            console.error("Lỗi khi tải danh mục thuốc:", error);
        }
    }

    // Gọi hàm khi trang tải xong
    document.addEventListener("DOMContentLoaded", fetchMedicinesIndex);
    document.addEventListener("DOMContentLoaded", fetchCategories);
</script>

</body>
</html>
